---
import CatCard from '../../components/CatCard.astro';
import type { Cat } from '../../interfaces/Cat';
import Layout from '../../layouts/Layout.astro';
import strapiFetch from '../../lib/strapi-fetch';
import qs from "qs";
    
const { catIdentifier } = Astro.params;

const catFiltered = await strapiFetch<Cat>({
    endpoint: "cats/" + catIdentifier, // the content type to fetch
    wrappedByKey: "data", // the key to unwrap the response
    query: qs.stringify({
        populate: {
            tags: {
                fields: ["name"],
            },
            photos: {
                fields: ["url"],
            },
        }
    }, {
        encodeValuesOnly: true, // prettify URL
    })
});

// To get ?toto=
const queryParams = Astro.url.searchParams.get('toto') || '';
console.log('queryParams', queryParams);

const pageTitle = 'Detail sur ' + catFiltered.name;
---

<Layout title={pageTitle}>
    <div class="flex flex-col w-full">
      <h1 class="text-3xl font-bold mx-auto my-6">{pageTitle}</h1>
      <CatCard cat={catFiltered} />
    </div>
</Layout>